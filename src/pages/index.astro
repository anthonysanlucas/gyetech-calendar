---
import MainLayout from '@/layouts/MainLayout.astro'
import ShareButton from '@/components/ShareButton.astro'
import SlideAnimationIcon from '@/components/SlideAnimationIcon.astro'
---

<MainLayout
  titlePage="Calendario de Eventos de la Comunidad | GYE TECH"
  descriptionPage="No te pierdas ningún evento de la comunidad tecnológica más grande del Ecuador, Guayaquil Tech.">
  <h1 class="text-center font-bold text-2xl py-10 tracking-wider [text-wrap:balance] sm:text-4xl">
    CALENDARIO DE EVENTOS
    <span class="text-primary">2024</span>
  </h1>
  <SlideAnimationIcon />
  <section class="w-full overflow-auto">
    <table class="mx-auto min-w-[57.5rem] w-max mb-4 border-b border-slate-100">
      <thead class="bg-slate-100 text-slate-600">
        <tr>
          <th
            class="px-8 py-6 w-max text-left text-sm leading-4 font-medium tracking-widest rounded-tl-md md:text-base">
            FECHA
          </th>
          <th
            class="px-8 py-6 w-max text-left text-sm leading-4 font-medium tracking-widest md:text-base">
            EVENTO
          </th>
          <th
            class="px-8 py-6 w-max text-left text-sm leading-4 font-medium tracking-widest md:text-base">
            ORGANIZADOR
          </th>
          <th
            class="px-8 py-6 w-max text-left text-sm leading-4 font-medium tracking-widest rounded-tr-md md:text-base">
            INFORMACIÓN
          </th>
        </tr>
      </thead>
      <tbody id="events">
        <!-- row container -->
      </tbody>
    </table>
  </section>
  <svg
    id="loading-spinner"
    class="animate-spin mt-8 mx-auto h-14 w-14 text-primary"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"
    ></circle>
    <path
      class="opacity-75"
      fill="currentColor"
      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
    ></path>
  </svg>
  <section class="flex justify-center items-center gap-x-4 my-10">
    <a
      href="https://github.com/Guayaquil-Tech/calendario-de-eventos"
      target="_blank"
      rel="noopener noreferrer"
      class="flex justify-center items-center w-full max-w-[7.948rem] gap-x-2 bg-slate-300 text-slate-700 font-medium py-2 px-4 rounded-md transition-colors duration-100 shadow-sm shadow-slate-300/40 hover:bg-white/90">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <mask
          id="mask0_124_3"
          style="mask-type:luminance"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24">
          <path d="M24 0H0V23.5102H24V0Z" fill="white"></path>
        </mask>
        <g mask="url(#mask0_124_3)">
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M11.9643 0C5.34832 0 0 5.38773 0 12.0531C0 17.3811 3.42686 21.8912 8.1808 23.4874C8.7752 23.6074 8.99291 23.2281 8.99291 22.909C8.99291 22.6295 8.97328 21.6717 8.97328 20.6738C5.64512 21.3923 4.95208 19.237 4.95208 19.237C4.41723 17.8401 3.62474 17.4811 3.62474 17.4811C2.53543 16.7427 3.70408 16.7427 3.70408 16.7427C4.91241 16.8225 5.54645 17.9799 5.54645 17.9799C6.61589 19.8157 8.33925 19.297 9.03259 18.9777C9.13152 18.1994 9.44864 17.6606 9.78539 17.3613C7.13093 17.0819 4.33812 16.0443 4.33812 11.4145C4.33812 10.0974 4.81323 9.01984 5.56603 8.18181C5.44725 7.88251 5.03118 6.64507 5.68507 4.98882C5.68507 4.98882 6.69525 4.66947 8.97307 6.22603C9.94827 5.96219 10.954 5.828 11.9643 5.82688C12.9745 5.82688 14.0043 5.96672 14.9552 6.22603C17.2332 4.66947 18.2434 4.98882 18.2434 4.98882C18.8973 6.64507 18.481 7.88251 18.3622 8.18181C19.1349 9.01984 19.5903 10.0974 19.5903 11.4145C19.5903 16.0443 16.7975 17.0618 14.1233 17.3613C14.5592 17.7404 14.9354 18.4587 14.9354 19.5963C14.9354 21.2126 14.9157 22.5098 14.9157 22.9087C14.9157 23.2281 15.1337 23.6074 15.7278 23.4877C20.4818 21.8909 23.9086 17.3811 23.9086 12.0531C23.9283 5.38773 18.5603 0 11.9643 0Z"
            fill="#24292F"></path>
        </g>
      </svg>
      <span class="text-center text-sm">GitHub</span>
    </a>
    <ShareButton />
  </section>
</MainLayout>

<script>
  // Spreadsheet ID and the name of the spreadsheet
  // Demo ID: 1ZEMXCnbwTo0vrvKmQaIuaGC9QVGGRrRwKwGmM10Tx60
  // Demo Sheet Name: 2023
  const SHEET_ID = '1ZEMXCnbwTo0vrvKmQaIuaGC9QVGGRrRwKwGmM10Tx60'
  const SHEET_NAME = '2024'
  // The URL of the spreadsheet to source data from. Make sure it is public or set to Anyone with link can view.
  const base = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?`

  // select column names
  const SQL_QUERY = `SELECT A, B, C, D`
  const query = encodeURIComponent(SQL_QUERY)

  const eventsContainer = document.getElementById('events')
  const loadingSpinner = document.getElementById('loading-spinner')

  fetch(`${base}&sheet=${SHEET_NAME}&tq=${query}`)
    .then(res => res.text())
    .then(rep => {
      const jsonString = rep.substring(rep.indexOf('{'), rep.lastIndexOf('}') + 1)
      const jsData = JSON.parse(jsonString)

      const spreadsheetRows = jsData.table.rows

      loadingSpinner.remove()

      eventsContainer.innerHTML = spreadsheetRows
        .map(row => {
          return `
          <tr class="transition-colors duration-100 hover:bg-primary/40">
            <td class="px-8 py-6">
              <p class="text-base leading-5 font-regular text-slate-100 md:text-lg">${
                row.c[0].f
              }</p>
            </td>
            <td class="px-8 py-6">
              <p class="text-base leading-5 font-regular text-slate-100 md:text-lg">${
                row.c[1].v
              }</p>
            </td>
            <td class="px-8 py-6">
              <p class="text-base leading-5 font-regular text-slate-100 md:text-lg">${
                row.c[2].v
              }</p>
            </td>
            <td class="px-2 py-4">
              <a class="px-6 py-2 text-primary/70 font-medium underline underline-offset-2 transition-colors duration-100 hover:text-primary" href=${
                row.c[3].v.includes('https://') ? row.c[3].v : `https://${row.c[3].v}`
              } target="_blank" rel="noopener noreferrer">Regístrate aquí</a>
            </td>  
          </tr>
        `
        })
        .join('')
    })
    .catch(error => console.log(error))
</script>
